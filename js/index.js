$(function(){KMA.init();$(window).resize(function(){KMA.modalRefresh();});KMA.modalRefresh();$(document).on("click","[modal]",function(){var modalWindow=$("div#"+$(this).attr("modal"));if(modalWindow.length){KMA.modalShow(modalWindow);return false;}}).on("click",".icon-close, .modal, .button-close",function(event){event.preventDefault();if(event.target!=this){return false;}else{KMA.modalHide($(this).closest(".modal"));}}).on("keydown",function(key){if(key.keyCode==27){KMA.modalHide($(".modal:visible:last"));}}).on("click",".modal > *",function(event){event.stopPropagation();return true;});$("#kmacb-form form").on("submit",function(event){event.preventDefault();var form=$("form:first"),form_from_popup=form.find("input[name=frompopup]");var datarow=$(this).serializeArray();$(datarow).each(function(item,itemData){try{form.find("[name="+itemData.name+"]").val(itemData.value);}catch(err){}});form_from_popup.val("1");form.trigger("submit").trigger("reset");});if($("#kmacb-form-append").length&&$("#kmacb-form form").length){$("#kmacb-form form").prepend($("#kmacb-form-append").html());$("#kmacb-form-append").remove();}$("form").append('<input type="hidden" name="jswork" value="1" />');$("form").append('<input type="hidden" name="frompopup" value="0" />');});var KMA=(function($,$n){return $.extend($n,{init:function(){this.setTimezone();this.initDataCountry();this.initMethodForm();this.checkPhoneLen();this.initAgreement();this.initTranslate();},modalHide:function($modal){$modal.fadeOut("fast",function(){if(!$(".modal:visible").length){$("body").removeClass("modal-show");$(document).trigger("kma.modal-hide");}});},modalRefresh:function(){if($(".modal:visible:last").length){var modalBlock=$(".modal:visible:last .modal-block"),width=parseInt(modalBlock.outerWidth()),height=parseInt(modalBlock.outerHeight());if($(window).height()>height+20){modalBlock.addClass("modal-top").removeClass("margin-t-b").css("margin-top",-1*(height/2));}else{modalBlock.addClass("margin-t-b").removeClass("modal-top");}if($(window).width()>width){modalBlock.addClass("modal-left").removeClass("margin-l").css("margin-left",-1*(width/2));}else{modalBlock.addClass("margin-l").removeClass("modal-left");}}},modalShow:function($modal){$modal.fadeIn("fast");$("body").addClass("modal-show");$(document).trigger("kma.modal-show");this.modalRefresh();},initCallback:function(timeout){try{$("#kmacb > a").on("click",function(event,disableTrigger){if(disableTrigger==undefined||!disableTrigger){$(document).trigger("kma.callbackOperator");}});if(window.kmacb_manager_class!=undefined){$("#kmacb").addClass(window.kmacb_manager_class);}if(window.kmacb_form_selector!=undefined){$("#kmacb > a").attr("kmacb-custom-form",window.kmacb_form_selector);$("#kmacb > a").on("click",function(event,disableTrigger){event.preventDefault();event.stopPropagation();$(window.kmacb_form_selector).trigger("click",[true]);});$(window.kmacb_form_selector).on("click",function(event,disableTrigger){if(disableTrigger==undefined||!disableTrigger){$(document).trigger("kma.callbackButton");}});}setTimeout(function start_kmacb(){$("#kmacb").show();},timeout);}catch(e){}},setTimezone:function(){var tz=new Date().getTimezoneOffset();$("form").append('<input type="hidden" name="timezone" value="'+tz+'" />');},setCountryField:function(country){$("form").append("<input type='hidden' name='country' value='"+country+"' />");},checkAndSetCountryField:function(country){if(!$("select[name=country]").length&&!$("input[name=country]").length){this.setCountryField(country);}},disableCountrySelect:function(country){if($("select[name=country]").length){$("select[name=country]").attr("disabled","disabled");this.setCountryField(country);}},showComebacker:false,initComebacker:function(timeout){var current=this;current.showComebacker=true;try{setTimeout(function start_kmacomebacker(){var comebacker=true;$(window).on("mouseout",function(event){if(event.pageY-$(window).scrollTop()<1&&comebacker){if(window.customPopupShowed!=undefined&&window.customPopupShowed===true){return;}if($(".modal:visible").length){return;}$(document).trigger("kma.mouseLeave");if(current.showLuckyForm){current.showLuckyForm=false;$("[modal="+current.selectorPathLuckyForm+"]").trigger("click");}else{$("#kmacb > a").trigger("click",[true]);comebacker=false;}}});},timeout);}catch(e){}},phoneMaxLen:25,checkPhoneLen:function(){var current=this;try{if(window.phone_max_length!=undefined&&window.phone_max_length!=""){current.phoneMaxLen=parseInt(window.phone_max_length);}}catch(err){}$(document).on("keypress","input[name=phone]",function(e){var reg1=new RegExp("[^0-9]*","g"),phone_txt=$(this).val().replace(reg1,"");if(phone_txt.length>=current.phoneMaxLen){e.preventDefault();}});},validateAndSendForm:function(jsonRequest,KMAText){var current=this;$(document).on("submit","form",function(){if(!$(this).closest("#kmacb-form").length){if(jsonRequest){current.prepareJsonData($(this));}$("input[name=name]",this).val($.trim($("input[name=name]",this).val()));if(!$("input[name=name]",this).val()){alert(KMAText.validation_name);return false;}var phone_val=$("input[name=phone]",this).val(),reg1=new RegExp("[^0-9]*","g"),reg2=new RegExp("[^0-9-+ ()]","g"),phone_txt=phone_val.replace(reg1,"");if(phone_val.search(reg2)!=-1){alert(KMAText.validation_phone1);return false;}if(!phone_txt||phone_txt.length<9){alert(KMAText.validation_phone2);return false;}if(phone_txt.length&&phone_txt.length>current.phoneMaxLen){alert(KMAText.validation_phone3);return false;}current.showComebackerAlert=false;try{var yaCounterID=($(this).attr("data-kma-yacounter-id-important")==undefined)?$(this).attr("data-kma-yacounter-id"):$(this).attr("data-kma-yacounter-id-important"),yaCounterGoal=($(this).attr("data-kma-yacounter-goal-important")==undefined)?$(this).attr("data-kma-yacounter-goal"):$(this).attr("data-kma-yacounter-goal-important");if(yaCounterID!=undefined&&yaCounterGoal!=undefined){yaCounterID=yaCounterID.trim();yaCounterGoal=yaCounterGoal.trim();if(yaCounterID!=""&&yaCounterGoal!=""){window["yaCounter"+yaCounterID.trim()].reachGoal(yaCounterGoal);}}}catch(err){console.log("Exception: Yandex Metrica - yaCounter");}try{if(window.kma_order_ga_params!=undefined&&ga!=undefined){ga("send",window.kma_order_ga_params);}}catch(err){console.log("Exception: Google Analitics - send event");}$(document).trigger("kma.form-validate");return true;}});$("a.order-btn").click(function(){$(this).closest("form").submit();return false;});},prepareJsonData:function(form){var datarow=form.serializeArray();var addressIsset=false;$(datarow).each(function(item,itemData){if(itemData.name=="address"){addressIsset=true;}if(itemData.name=="name"||itemData.name=="phone"||itemData.name=="address"){delete datarow[item];}});if(addressIsset==false){form.append("<input type='hidden' name='address' />");}form.find("input[name='address']").val($.JSON.encode(datarow));},initVibrate:function(timeout){setInterval(function(){try{if(window.navigator&&window.navigator.vibrate){navigator.vibrate([50,30,100,30,100,30,100,30,100,30,100,30,100,30,100,30,100,30,100,30]);}else{navigator.vibrate(0);}}catch(err){}},timeout);},showComebackerAlert:true,initComebackerAlert:function(KMAText){var current=this;window.onbeforeunload=function(evt){if(current.showComebackerAlert){current.showComebackerAlert=false;$("form").append('<input type="hidden" name="aftercomebacker" value="1" />');return KMAText.comebacker_text;}};},showNewsBlogIframe:true,funcNewsBlogIframe:function(KMAText,url){var current=this;if(current.showNewsBlogIframe){current.showNewsBlogIframe=false;$("body").css({overflow:"hidden",background:"#FFF",}).html('<iframe src="'+url+'" id="comebacker_smi" style="position:fixed;border:none;top:0;left:0;right:0;bottom:0;width:100%;height:100%;z-index:9999999999;"></iframe>');return KMAText.comebacker_text;}},initNewsBlogIframe:function(KMAText,url,secWait){var current=this;var idleTimer=null,idleWait=parseInt(secWait)*1000;$(document).on("mousemove keydown scroll",function(){clearTimeout(idleTimer);idleTimer=setTimeout(function(){current.funcNewsBlogIframe(KMAText,url);},idleWait);});$("body").trigger("mousemove");},initRedirectAfterSomeSeconds:function(url,secWait){var idleTimer=null,idleWait=parseInt(secWait)*1000;$(document).on("mousemove keydown scroll",function(){clearTimeout(idleTimer);idleTimer=setTimeout(function(){window.location.href=url;},idleWait);});},initDataCountry:function(){var current=this;current.changeDataCountry(window.country);current.changeDataNotCountry(window.country);$(".country_select").change(function(){current.changeDataCountry($(this).val());current.changeDataNotCountry($(this).val());});},eur:["AT","BG","GB","HU","DE","GR","ES","IT","CY","MK","NL","PL","PT","RO","RS","SK","SI","TR","FR","HR","CZ","CH","BE","IL","LV","LT","LU","NO","SE","EE"],sng:["RU","UA","BY","KZ","MD","KG","UZ","AZ","AM","TJ","TM","GE","UZ"],changeDataCountry:function(country){var current=this;$.each($("[data-kma-country]"),function(){var country_str=$(this).attr("data-kma-country").split(" ").join("").toUpperCase(),country_arr=country_str.split(","),change_class=($(this).is("[data-kma-class]"))?$(this).attr("data-kma-class"):undefined,geo_area=undefined;if(current.sng.indexOf(country)>-1){geo_area="SNG";}else{if(current.eur.indexOf(country)>-1){geo_area="EUR";}}if(country_arr.indexOf(country)>-1||(geo_area!=undefined&&country_arr.indexOf(geo_area)>-1)){if(change_class!=undefined){$(this).addClass(change_class);}else{$(this).show();}}else{if(change_class!=undefined){$(this).removeClass(change_class);}else{$(this).hide();}}});},changeDataNotCountry:function(country){var current=this;$.each($("[data-kma-not-country]"),function(){var country_str=$(this).attr("data-kma-not-country").split(" ").join("").toUpperCase(),country_arr=country_str.split(","),geo_area=undefined;if(current.sng.indexOf(country)>-1){geo_area="SNG";}else{if(current.eur.indexOf(country)>-1){geo_area="EUR";}}if(country_arr.indexOf(country)>-1||(geo_area!=undefined&&country_arr.indexOf(geo_area)>-1)){$(this).hide();}else{$(this).show();}});},initAgreement:function(){if(!$("[modal=agreement]").length){var $polit=$("[modal=polit]:visible:last"),$agreement=$polit.clone();$polit.after($agreement.attr("modal","agreement").text("Пользовательское соглашение"));$polit.after("<br>");}},ruLangList:["ru","az","be","kk","uk","ka","uz","ky","am","tg"],initTranslate:function(){var current=this,$agreement=$("[modal=agreement]:visible:last"),$policy=$("[modal=polit]:visible:last");if($agreement.length){if(current.ruLangList.indexOf(window.lang)>-1){$agreement.text("Пользовательское соглашение");}else{$agreement.text("User Agreement");}}if($policy.length){if(current.ruLangList.indexOf(window.lang)>-1){$policy.text("Политика конфиденциальности");}else{$policy.text("Privacy Policy");}}},initMethodForm:function(){$("form").attr("method","POST");},vallidateEmail:function(email){var re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return re.test(email);},validateHostLuckyForm:function(){var host=window.host,hostObj={varanga:{name:"Варанги",name2:"Варангу"},gelmifort:{name:"Gelmifort",name2:"Gelmifort"},papiderm:{name:"Papiderm",name2:"Papiderm"},personalslim:{name:"Personal Slim",name2:"Personal Slim"},adenofrin:{name:"Аденофрина",name2:"Аденофрин"},alligator:{name:"Аллигатора",name2:"Аллигатор"},inderm:{name:"Inderma",name2:"Inderma"},pantogor:{name:"Пантогора",name2:"Пантогор"},gipertonium:{name:"Гипертониума",name2:"Гипертониум"},ironprost:{name:"IronProst",name2:"IronProst"},"recept-gor":{name:"Рецепта гор",name2:"Рецепт гор"},alkotoxic:{name:"Alkotoxic",name2:"Alkotoxic"},inblanc:{name:"Inblanc",name2:"Inblanc"},"skin-matrix":{name:"SkinMatrix",name2:"SkinMatrix"},neolid:{name:"Neolid",name2:"Neolid"},loromax:{name:"Лоромакс",name2:"Лоромакс"},dialux:{name:"Dialux",name2:"Dialux"},varitox:{name:"Varitox",name2:"Varitox"},ezotonplus:{name:"Ezoton Plus",name2:"Ezoton Plus"},"drywall-care":{name:"Drywall",name2:"Drywall"},allegard:{name:"Allegard",name2:"Allegard"},headrix:{name:"Headrix",name2:"Headrix"},restox:{name:"Restox",name2:"Restox"},neosense:{name:"Neosense",name2:"Neosense"},holemin:{name:"Холемина",name2:"Холемин"},gasterox:{name:"Gasterox",name2:"Gasterox"},dryzer:{name:"Dryzer",name2:"Dryzer"},redlock:{name:"Redlock",name2:"Redlock"},unigem:{name:"Unigem",name2:"Unigem"},neyrolock:{name:"Neyrolock",name2:"Neyrolock"},infit:{name:"InFit",name2:"InFit"},skinfort:{name:"Skinfort",name2:"Skinfort"},"g-point":{name:"gpoint",name2:"gpoint"},vizox:{name:"Vizox",name2:"Vizox"},pazax:{name:"Pazax",name2:"Pazax"},injoint:{name:"Injoint",name2:"Injoint"}};try{var resultObj;Object.keys(hostObj).forEach(function(item){if(host.indexOf(item)!=-1){resultObj={product_name:hostObj[item]["name"],product_name2:hostObj[item]["name2"],disclaimer:""};return;}});return resultObj;}catch(e){}return false;},hostInfoLuckyForm:false,validateLuckyForm:function(){var current=this,randomBoolean=true;if(localStorage.getItem(current.lsKeyLuckyForm)!=="2"&&randomBoolean&&window.lang=="ru"&&$("#"+current.selectorPathLuckyForm).length){console.log("LF: in validate");var hostInfo=current.validateHostLuckyForm();if(!hostInfo){return false;}try{var s4=parseInt(window.country_list.RU["s4"]),s1=parseInt(window.country_list.RU["s1"])||0,valid_s1=[1,147,477,0];if(valid_s1.indexOf(s1)!=-1){hostInfo.disclaimer="* при заказе курса";}if(s4==294&&(s1==0||s1==147)){hostInfo.disclaimer="* при заказе программы";}current.hostInfoLuckyForm=hostInfo;}catch(e){return false;}return true;}return false;},showLuckyForm:false,selectorPathLuckyForm:"lucky-form-container",lsKeyLuckyForm:"lucky-form-state",initLuckyForm:function(){var current=this;if(!current.showComebacker){return;}console.log("LF: before validate");if(current.validateLuckyForm()){console.log("LF: after validate");current.showLuckyForm=true;$("#lucky-form .productName").text(current.hostInfoLuckyForm.product_name);localStorage.setItem(current.lsKeyLuckyForm,"1");try{$(document).on("mfpOpen",function(){console.log("LF mfpOpen");if($("#"+current.selectorPathLuckyForm).is(":visible")){$.magnificPopup.close();console.log("LF mfpOpen - close");}});$("#lucky-form .email-form").on("submit",function(event){event.preventDefault();var form=$(this);if(!current.vallidateEmail(form.find("[name=email]").val())){form.find("[name=email]").addClass("has-error");return false;}form.find("[name=email]").removeClass("has-error");$.ajax({type:form.attr("method"),url:form.attr("action"),data:form.serialize()}).done(function(data){localStorage.setItem(current.lsKeyLuckyForm,"2");form.hide();$("#lucky-form .loading").show();if($(document).width()<=992){$(".mfp-wrap").animate({scrollTop:0},100);}$("#lucky-form .lcircle").addClass("rotate2");setTimeout(function(){var s1=$(".price_land_s1:visible").eq(0).text()||$(".price_land_s3:visible").eq(0).text()||0,s4=$(".price_land_s4:visible").eq(0).text()||"",curr=$(".price_land_curr:visible").eq(0).text(),disclaimer=current.hostInfoLuckyForm.disclaimer,sup=(disclaimer!="")?"*":"",price_text="";$("#lucky-form .loading").hide();if(sup!=""){price_text+="Получите";}else{price_text+="Закажите";}price_text+=" "+current.hostInfoLuckyForm.product_name2;if(parseInt(s1)==0||s1==""){price_text+=" <span class='newPrice'>Бесплатно"+sup+"</span>";}else{price_text+=" за <span class='newPrice'>"+s1+sup+" "+curr+"</span>";}if(s4!=""){price_text+=" вместо <span class='oldPrice'>"+s4+" "+curr+"</span>";}$("#lucky-form .lucky-form p.subHeader2").html(price_text);$("#lucky-form .lucky-form p.subHeader").html("Удача сегодня не на Вашей стороне, но мы готовы предложить Вам персональную скидку!");$("#lucky-form .lucky-form h3").html("Не расстраивайтесь!");$("#lucky-form .order-form .lformBtn + .disclaimer").html(disclaimer);$("#lucky-form .order-form").show();},3500);});return false;});$("#lucky-form .icon-close").on("click",function(){localStorage.setItem(current.lsKeyLuckyForm,"2");});}catch(e){current.showLuckyForm=false;return false;}}}});})(jQuery,KMA||{});
$('.formBtn').on("click", function(){
    $('body, html').animate({
        scrollTop: $('section:nth-of-type(9)').position().top
    },1000);
});
(function($){function getElementIdentifier(el){return"[id="+el.attr("id")+"][name="+el.attr("name")+"]";}$.fn.sisyphus=function(options){var identifier=$.map(this,function(obj){return getElementIdentifier($(obj));}).join();var sisyphus=Sisyphus.getInstance(identifier);sisyphus.protect(this,options);return sisyphus;};var browserStorage={};browserStorage.isAvailable=function(){if(typeof $.jStorage==="object"){return true;}try{return localStorage.getItem;}catch(e){return false;}};browserStorage.set=function(key,value){if(typeof $.jStorage==="object"){$.jStorage.set(key,value+"");}else{try{localStorage.setItem(key,value+"");}catch(e){}}};browserStorage.get=function(key){if(typeof $.jStorage==="object"){var result=$.jStorage.get(key);return result?result.toString():result;}else{return localStorage.getItem(key);}};browserStorage.remove=function(key){if(typeof $.jStorage==="object"){$.jStorage.deleteKey(key);}else{localStorage.removeItem(key);}};Sisyphus=(function(){var params={instantiated:[],started:[]};var CKEDITOR=window.CKEDITOR;function init(){return{setInstanceIdentifier:function(identifier){this.identifier=identifier;},getInstanceIdentifier:function(){return this.identifier;},setInitialOptions:function(options){var defaults={excludeFields:[],customKeySuffix:"",locationBased:false,timeout:0,autoRelease:true,onBeforeSave:function(){},onSave:function(){},onBeforeRestore:function(){},onRestore:function(){},onRelease:function(){}};this.options=this.options||$.extend(defaults,options);this.browserStorage=browserStorage;},setOptions:function(options){this.options=this.options||this.setInitialOptions(options);this.options=$.extend(this.options,options);},protect:function(targets,options){this.setOptions(options);targets=targets||{};var self=this;this.targets=this.targets||[];if(self.options.name){this.href=self.options.name;}else{this.href=location.hostname+location.pathname+location.search+location.hash;}this.targets=$.merge(this.targets,targets);this.targets=$.unique(this.targets);this.targets=$(this.targets);if(!this.browserStorage.isAvailable()){return false;}var callback_result=self.options.onBeforeRestore.call(self);if(callback_result===undefined||callback_result){self.restoreAllData();}if(this.options.autoRelease){self.bindReleaseData();}if(!params.started[this.getInstanceIdentifier()]){if(self.isCKEditorPresent()){var intervalId=setInterval(function(){if(CKEDITOR.isLoaded){clearInterval(intervalId);self.bindSaveData();params.started[self.getInstanceIdentifier()]=true;}},100);}else{self.bindSaveData();params.started[self.getInstanceIdentifier()]=true;}}},isCKEditorPresent:function(){if(this.isCKEditorExists()){CKEDITOR.isLoaded=false;CKEDITOR.on("instanceReady",function(){CKEDITOR.isLoaded=true;});return true;}else{return false;}},isCKEditorExists:function(){return typeof CKEDITOR!=="undefined";},findFieldsToProtect:function(target){return target.find(":input").not(":submit").not(":reset").not(":button").not(":file").not(":password").not(":disabled").not("[readonly]");},bindSaveData:function(){var self=this;if(self.options.timeout){self.saveDataByTimeout();}self.targets.each(function(){var targetFormIdAndName=getElementIdentifier($(this));self.findFieldsToProtect($(this)).each(function(){if($.inArray(this,self.options.excludeFields)!==-1){return true;}var field=$(this);var prefix=(self.options.locationBased?self.href:"")+targetFormIdAndName+getElementIdentifier(field)+self.options.customKeySuffix;if(field.is(":text")||field.is("textarea")){if(!self.options.timeout){self.bindSaveDataImmediately(field,prefix);}}self.bindSaveDataOnChange(field);});});},saveAllData:function(){var self=this;self.targets.each(function(){var targetFormIdAndName=getElementIdentifier($(this));var multiCheckboxCache={};self.findFieldsToProtect($(this)).each(function(){var field=$(this);if($.inArray(this,self.options.excludeFields)!==-1||(field.attr("name")===undefined&&field.attr("id")===undefined)){return true;}var prefix=(self.options.locationBased?self.href:"")+targetFormIdAndName+getElementIdentifier(field)+self.options.customKeySuffix;var value=field.val();if(field.is(":checkbox")){var name=field.attr("name");if(name!==undefined&&name.indexOf("[")!==-1){if(multiCheckboxCache[name]===true){return;}value=[];$("[name='"+name+"']:checked").each(function(){value.push($(this).val());});multiCheckboxCache[name]=true;}else{value=field.is(":checked");}self.saveToBrowserStorage(prefix,value,false);}else{if(field.is(":radio")){if(field.is(":checked")){value=field.val();self.saveToBrowserStorage(prefix,value,false);}}else{if(self.isCKEditorExists()){var editor=CKEDITOR.instances[field.attr("name")]||CKEDITOR.instances[field.attr("id")];if(editor){editor.updateElement();self.saveToBrowserStorage(prefix,field.val(),false);}else{self.saveToBrowserStorage(prefix,value,false);}}else{self.saveToBrowserStorage(prefix,value,false);}}}});});self.options.onSave.call(self);},restoreAllData:function(){var self=this;var restored=false;self.targets.each(function(){var target=$(this);var targetFormIdAndName=getElementIdentifier($(this));self.findFieldsToProtect(target).each(function(){if($.inArray(this,self.options.excludeFields)!==-1){return true;}var field=$(this);var prefix=(self.options.locationBased?self.href:"")+targetFormIdAndName+getElementIdentifier(field)+self.options.customKeySuffix;var resque=self.browserStorage.get(prefix);if(resque!==null){self.restoreFieldsData(field,resque);restored=true;}});});if(restored){self.options.onRestore.call(self);}},restoreFieldsData:function(field,resque){if(field.attr("name")===undefined&&field.attr("id")===undefined){return false;}var name=field.attr("name");if(field.is(":checkbox")&&resque!=="false"&&(name===undefined||name.indexOf("[")===-1)){field.prop("checked",true);}else{if(field.is(":checkbox")&&resque==="false"&&(name===undefined||name.indexOf("[")===-1)){field.prop("checked",false);}else{if(field.is(":radio")){if(field.val()===resque){field.prop("checked",true);}}else{if(name===undefined||name.indexOf("[")===-1){field.val(resque);}else{resque=resque.split(",");field.val(resque);}}}}},bindSaveDataImmediately:function(field,prefix){var self=this;if("onpropertychange" in field){field.get(0).onpropertychange=function(){self.saveToBrowserStorage(prefix,field.val());};}else{field.get(0).oninput=function(){self.saveToBrowserStorage(prefix,field.val());};}if(this.isCKEditorExists()){var editor=CKEDITOR.instances[field.attr("name")]||CKEDITOR.instances[field.attr("id")];if(editor){editor.document.on("keyup",function(){editor.updateElement();self.saveToBrowserStorage(prefix,field.val());});}}},saveToBrowserStorage:function(key,value,fireCallback){var self=this;var callback_result=self.options.onBeforeSave.call(self);if(callback_result!==undefined&&callback_result===false){return;}fireCallback=fireCallback===undefined?true:fireCallback;this.browserStorage.set(key,value);if(fireCallback&&value!==""){this.options.onSave.call(this);}},bindSaveDataOnChange:function(field){var self=this;field.change(function(){self.saveAllData();});},saveDataByTimeout:function(){var self=this;var targetForms=self.targets;setTimeout((function(){function timeout(){self.saveAllData();setTimeout(timeout,self.options.timeout*1000);}return timeout;})(targetForms),self.options.timeout*1000);},bindReleaseData:function(){var self=this;self.targets.each(function(){var target=$(this);var formIdAndName=getElementIdentifier(target);$(this).bind("submit reset",function(){self.releaseData(formIdAndName,self.findFieldsToProtect(target));});});},manuallyReleaseData:function(){var self=this;self.targets.each(function(){var target=$(this);var formIdAndName=getElementIdentifier(target);self.releaseData(formIdAndName,self.findFieldsToProtect(target));});},releaseData:function(targetFormIdAndName,fieldsToProtect){var released=false;var self=this;params.started[self.getInstanceIdentifier()]=false;fieldsToProtect.each(function(){if($.inArray(this,self.options.excludeFields)!==-1){return true;}var field=$(this);var prefix=(self.options.locationBased?self.href:"")+targetFormIdAndName+getElementIdentifier(field)+self.options.customKeySuffix;self.browserStorage.remove(prefix);released=true;});if(released){self.options.onRelease.call(self);}}};}return{getInstance:function(identifier){if(!params.instantiated[identifier]){params.instantiated[identifier]=init();params.instantiated[identifier].setInstanceIdentifier(identifier);params.instantiated[identifier].setInitialOptions();}if(identifier){return params.instantiated[identifier];}return params.instantiated[identifier];},free:function(){params={instantiated:[],started:[]};return null;},version:"1.1.2"};})();})(jQuery);
function sendFormDataTmp(field, value, target)
{
    var data = {}, 
        form = target.closest('form');
    data.form_update_from_script = 1;
    data.form_data = {};
    switch(field)
    {
        case 'name':
            if(value.length > 4)
            {
                data.fio = value;
            }
        break;
        case 'phone':
            if(value.length > 8)
            {
                data.phone = value;
            }
        break;
        case 'country':
            if(value.length == 2)
            {
                data.country = value;
            }
        break;
    }
    $('input', form).each(function(){
        var name = $(this).attr('name'),
            value = $(this).val();
        if(typeof name != 'undefined' && name != '' && typeof value != 'undefined' && value != '')
        {
            data.form_data[name] = value;    
        }        
    });
    $('select', form).each(function(){
        var name = $(this).attr('name'),
            value = $(this).val();
        if(typeof name != 'undefined' && name != '' && typeof value != 'undefined' && value != '')
        {
            data.form_data[name] = value;    
        }        
    });
    $.get(tmp_data_to_server, data);
    
}

$(document).ready(function(){
    $('form').sisyphus();
    $('input[type=text],input[type=tel]').keyup(function(event){
        var target = $(event.currentTarget);
        if(target.attr('name') == 'name' || target.attr('name') == 'phone')
        {
            if(typeof target.attr('oldvalue') == 'undefined')
            {
                oldval = '';
            }
            else
            {
                oldval = target.attr('oldvalue');    
            }
            if(oldval != target.val())
            {
                target.attr('oldvalue', target.val());    
                sendFormDataTmp(target.attr('name'), target.val(), target);
            }
        }
    });
    $('input[type=text],input[type=tel]').change(function(event){
        var target = $(event.currentTarget);
        if(target.attr('name') == 'name' || target.attr('name') == 'phone')
        {
            if(typeof target.attr('oldvalue') == 'undefined')
            {
                oldval = '';
            }
            else
            {
                oldval = target.attr('oldvalue');    
            }
            if(oldval != target.val())
            {
                target.attr('oldvalue', target.val());    
                sendFormDataTmp(target.attr('name'), target.val(), target);    
            }
        }
    });
    $('input[type=text],input[type=tel]').each(function(){
        var target = $(this);
        if(target.attr('name') == 'name' || target.attr('name') == 'phone')
        {
            target.attr('oldvalue', target.val());    
            if(target.val() != '')
            {
                sendFormDataTmp(target.attr('name'), target.val(), target);    
            }
        }
    });
});